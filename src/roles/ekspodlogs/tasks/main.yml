---

- name: Check ekspodlogs version
  shell: 'ekspodlogs -v'
  register: ekspodlogs_version_client_installed
  changed_when: false
  failed_when: false
  check_mode: no

- name: Check ekspodlogs version
  shell: '/bin/true'
  changed_when: ekspodlogs_version_client_installed.stdout != ekspodlogs_version
  check_mode: no

- name: Download ekspodlogs
  get_url:
    url: https://github.com/sgaunet/ekspodlogs/releases/download/v{{ ekspodlogs_version }}/ekspodlogs_{{ ekspodlogs_version }}_{{ ekspodlogs_os }}_{{ ekspodlogs_arch }}
    dest: "{{ ekspodlogs_bin_path }}/ekspodlogs"
    remote_src: true
    mode: 0755
  when:
    - not ansible_check_mode
    - ekspodlogs_version != ekspodlogs_version_client_installed.stdout
