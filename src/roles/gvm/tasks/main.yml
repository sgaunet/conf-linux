---

- name: Check gvm setup
  become: false
  ansible.builtin.command: gvm version
  register: gvm_version
  changed_when: false
  failed_when: false
  check_mode: false

- name: Install prerequisistes
  ansible.builtin.apt:
    name: ['curl', 'git', 'mercurial', 'make', 'binutils', 'bison', 'gcc', 'build-essential']
    state: present
    update_cache: true

- name: Install gvm
  ansible.builtin.shell: bash < <(curl -s -S -L https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer)
  when: gvm_version.rc != 0

- name: Configure bashrc
  become: false
  ansible.builtin.lineinfile:
    path: "{{ lookup('env', 'HOME') }}/.bashrc"
    line: "[[ -s \"{{ lookup('env', 'HOME') }}/.gvm/scripts/gvm\" ]] && source \"/home/sylvain/.gvm/scripts/gvm\""
  when: gvm_version.rc != 0
